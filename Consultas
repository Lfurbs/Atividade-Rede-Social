--1º Consulta Isaac

SELECT 
    UT.Nome_Tag, 
    COUNT(UT.Nome_User) AS Total_Usuarios
FROM 
    UsuarioTag UT
GROUP BY 
    UT.Nome_Tag
ORDER BY 
    Total_Usuarios DESC;

--2º Consulta Isaac

SELECT 
    P.Tipo AS Tipo_Conteudo,
    COUNT(P.ID_Postagem) AS Total_Postagens,
    COALESCE(SUM(AP.Total_Likes), 0) AS Total_Likes,
    ROUND(COALESCE(SUM(AP.Total_Likes), 0) / COUNT(P.ID_Postagem), 2) AS Likes_Por_Postagem
FROM Postagens P
LEFT JOIN (
    SELECT 
        ID_Postagem_Avaliada, 
        COUNT(*) AS Total_Likes
    FROM Avaliacoes_Postagens
    WHERE Tipo = 'curtiu seu post'
    GROUP BY ID_Postagem_Avaliada
) AP ON P.ID_Postagem = AP.ID_Postagem_Avaliada
GROUP BY P.Tipo
ORDER BY Total_Likes DESC;

--3º Consulta Isaac
SELECT 
    c.Conteudo AS Comentario,
    c.ID_Postagem_Pai AS Postagem_Relacionado,
    c.Data_Hora AS DataComentario
FROM 
    Comentarios c
WHERE 
    c.Autor = 'nome_do_usuario'  
ORDER BY 
    c.Data_Hora DESC; 


--4º Consulta Thayuan
SELECT 
    'Postagem' AS Tipo,
    P.Autor AS Usuario,
    P.Conteudo AS Conteudo,
    P.Data_Criacao AS Data_Hora
FROM 
    Postagens P

UNION ALL

SELECT 
    'Comentário' AS Tipo,
    C.Autor AS Usuario,
    C.Conteudo AS Conteudo,
    C.Data_Hora AS Data_Hora
FROM 
    Comentarios C
ORDER BY 
    Data_Hora DESC;

--5º Consulta Thayuan
SELECT 
    G.Nome AS Nome_Grupo,
    M.Nome_User AS Nome_Usuario,
    M.Funcao AS Funcao
FROM 
    Membro_Grupo M
INNER JOIN 
    Grupo G ON M.ID_Grupo = G.ID_Grupo
ORDER BY 
    G.Nome, M.Funcao;

